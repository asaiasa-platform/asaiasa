version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "Installing dependencies in website directory"
        - cd website
        - npm ci
    build:
      commands:
        - echo "Building Next.js app"
        - cd website
        - npm run build
        - echo "Moving build artifacts to root"
        - cp -r .next ../
        - echo "Creating redirects file"
        - echo "/ /en/home 302" > ../_redirects
        - echo "/* /index.html 200" >> ../_redirects
        - cp ../_redirects ../.next/
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - website/node_modules/**/*
      - website/.next/cache/**/*
  # Environment variables (configure these in Amplify Console)
  # NEXT_PUBLIC_GO_API_URL: https://your-backend-api.com
  # NEXT_PUBLIC_S3_BUCKET1: your-s3-bucket1.s3.amazonaws.com  
  # NEXT_PUBLIC_S3_BUCKET2: your-s3-bucket2.s3.amazonaws.com
  # NEXT_PUBLIC_S3_BUCKET3: your-s3-bucket3.s3.amazonaws.com
  # GOOGLE_CLIENT_ID: your-google-client-id
  # NEXT_PUBLIC_GOOGLE_CLIENT_ID: your-google-client-id
  # NODE_ENV: production
